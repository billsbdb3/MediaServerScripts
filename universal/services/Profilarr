#!/usr/bin/env bash
scriptVersion="1.0"
scriptName="Profilarr"

#### Import Settings
source /config/extended.conf
#### Import Functions
source /config/extended/functions
#### Create Log File
logfileSetup

# Verify that the service is enabled
if [ "$enableProfilarr" != "true" ]; then
  log "Profilarr service is disabled in configuration. Exiting."
  exit 0
fi

# Get Arr app information and verify API access
getArrAppInfo
verifyApiAccess

# Update the Profilarr configuration before running the import and sync scripts
log "Updating Profilarr configuration file"
updateProfilarrConfig

log "Starting Profilarr import and sync..."

log "Navigating to profilarr"
cd /profilarr || { log "ERROR: Failed to change directory to /profilarr"; exit 1; }

# Run import script with automated input
log "Running importarr.py"
if printf "1\n1\n" | python3 importarr.py >> "$logfile" 2>&1; then
  log "Profilarr import completed successfully."
else
  log "ERROR: Profilarr import encountered an error."
fi

# Run sync script with automated input
log "Running syncarr.py"
if printf "1\n1\n" | python3 syncarr.py >> "$logfile" 2>&1; then
  log "Profilarr sync completed successfully."
else
  log "ERROR: Profilarr sync encountered an error."
fi

log "Completed Profilarr import and sync."
